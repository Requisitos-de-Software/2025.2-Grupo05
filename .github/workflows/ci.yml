# .github/workflows/ci.yml

name: build and deploy
on:
  push:
    branches:
      - main

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - name: Instalar depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install ruff black bandit
      
      - name: Validar build do MkDocs
        run: mkdocs build --strict

      - name: Verificar c√≥digo Python com Ruff
        run: ruff check .

      - name: Verificar formata√ß√£o do c√≥digo Python com Black
        run: black --check .

  fix-suggestions-python:
    runs-on: ubuntu-latest
    # S√≥ roda se o job 'validate' falhar
    if: failure() && needs.validate.result == 'failure'
    needs: validate
    name: "Fix üß∞üõ†Ô∏è"
    steps:
      - name: Mostrar comandos de corre√ß√£o para Python
        run: |
          echo "################################################################"
          echo "#                                                              #"
          echo "#          ERROS DE C√ìDIGO OU FORMATA√á√ÉO ENCONTRADOS!          #"
          echo "#                                                              #"
          echo "################################################################"
          echo ""
          echo "Para corrigir automaticamente, rode os seguintes comandos:"
          echo ""
          echo "# Para formatar o c√≥digo:"
          echo "black ."
          echo ""
          echo "# Para corrigir outros erros de lint:"
          echo "ruff check . --fix"
          echo ""

  deploy:
    runs-on: ubuntu-latest
    # O deploy continua dependendo da valida√ß√£o. Se a valida√ß√£o falhar,
    # o deploy n√£o acontece e o job de corre√ß√£o √© exibido.
    needs: validate
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - name: Instalar depend√™ncias da documenta√ß√£o
        run: pip install -r requirements.txt
      - name: Fazer o deploy da documenta√ß√£o
        run: mkdocs gh-deploy --force