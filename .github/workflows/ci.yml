# .github/workflows/ci.yml

name: build and deploy
on:
  push:
    branches:
      - main

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - name: Instalar depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install ruff black bandit
      
      - name: Validar build do MkDocs
        run: mkdocs build --strict

      - name: Verificar c√≥digo Python com Ruff
        run: ruff check .

      - name: Verificar formata√ß√£o do c√≥digo Python com Black
        run: black --check .

      # --- NOVO PASSO ADICIONADO AQUI ---
      - name: Validar Markdown com markdownlint
        uses: DavidAnson/markdownlint-cli2-action@v15
        with:
          # Adiciona a flag para ignorar o diret√≥rio 'site'
          globs: |
            **/*.md
            !site

  # O resto do arquivo continua igual...
  fix-suggestions-python:
    runs-on: ubuntu-latest
    if: failure() && needs.validate.result == 'failure'
    needs: validate
    name: "Fix üß∞üõ†Ô∏è"
    steps:
      - name: Mostrar comandos de corre√ß√£o para Python
        run: |
          echo "################################################################"
          echo "#                                                              #"
          echo "#          ERROS DE C√ìDIGO OU FORMATA√á√ÉO ENCONTRADOS!          #"
          echo "#                                                              #"
          echo "################################################################"
          echo ""
          echo "Para corrigir automaticamente, rode os seguintes comandos:"
          echo ""
          echo "# Para formatar o c√≥digo:"
          echo "black ."
          echo ""
          echo "# Para corrigir outros erros de lint:"
          echo "ruff check . --fix"
          echo ""
          echo "# Para corrigir erros de Markdown:"
          echo "markdownlint-cli2 --fix \"{**/*.md,**/*.MD}\" \"#site\""
          echo ""

  deploy:
    runs-on: ubuntu-latest
    # needs: validate
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - name: Instalar depend√™ncias da documenta√ß√£o
        run: pip install -r requirements.txt
      - name: Fazer o deploy da documenta√ß√£o
        run: mkdocs gh-deploy --force
